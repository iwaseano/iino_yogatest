# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: yoga-reservation-system
metadata:
  template: yoga-reservation-system@0.0.1-beta
  
services:
  web:
    project: ./
    dist: ./
    host: staticwebapp
    
  api:
    project: ./api
    language: python
    host: function

hooks:
  prerestore:
    shell: pwsh
    run: |
      Write-Host "Installing Python dependencies for Function App..."
      if (Test-Path "./api/requirements.txt") {
        pip install -r ./api/requirements.txt
      }
  
  prepackage:
    shell: pwsh
    run: |
      Write-Host "Preparing deployment package..."
      # Function Appの依存関係を確認
      if (!(Test-Path "./api/requirements.txt")) {
        Write-Error "requirements.txt not found in api directory"
        exit 1
      }

infra:
  provider: bicep
  path: infra
  module: main
